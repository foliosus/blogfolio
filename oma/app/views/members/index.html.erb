<%= content_tag(:p, link_to('Add a new member', new_member_path)) if logged_in? && @current_user.has_role?(:secretary) %>

<%- form_tag request.path, :method => :get, :class => 'member_search' do %>
<h4>Search criteria</h4>
  <%- if logged_in?&& @current_user.has_role?(:secretary) -%>
  <ul>
    <%- for scope in Member.exclusive_scopes -%>
      <li><%= radio_button_tag "scopes[]", scope, @current_scopes.include?(scope) %> <%= scope.to_s.humanize.capitalize %></li>
    <%- end -%>
  </ul>
  <ul>
    <%- for scope in Member.public_scopes - Member.exclusive_scopes -%>
      <li><%= check_box_tag "scopes[]", scope, @current_scopes.include?(scope) %> <%= scope.to_s.humanize.capitalize %></li>
    <%- end -%>
  </ul>
  <%- end -%>
  <p><%= text_field_tag :search, @search_params, :size => 20, :maxlength => 20 %></p>
  <p><%= submit_tag 'Search', :name => nil %></p>
<%- end -%>

<%- if @members.length == 0 -%>
  <h4>Sorry!</h4>

  <p>No members matched your search criteria.  Please try again with the form above.</p>
<%- else -%>
  <%= content_tag(:p, link_to('Download a CSV of this list', download_members_path(:scopes => @current_scopes), :title => "Get the full search results as a CSV (comma-separated-values) file")) if logged_in?&& @current_user.has_role?(:secretary) %>

  <p><%= page_entries_info @members %></p>

  <p><%= will_paginate @members %></p>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Location</th>
        <th colspan="3">Actions</th>
      </tr>
    </thead>

    <tbody>
    <%- for member in @members -%>
      <tr class="<%= cycle('odd', 'even') %>">
        <td><%=h member.full_name(true) %></td>
        <td><%=h member.city %>, <%=h member.state %></td>
        <td><%= link_to('Show', member) if logged_in?&& @current_user.can_read_member? %></td>
        <td><%= link_to('Edit', edit_member_path(member)) if logged_in?&& @current_user.can_update_member? %></td>
        <td><%= link_to('Destroy', member, :confirm => 'Are you sure?', :method => :delete) if logged_in?&& @current_user.can_delete_member? %></td>
      </tr>
    <%- end -%>
    </tbody>
  </table>
  
<%- end -%>

<%= content_tag(:p, link_to('Add a new member', new_member_path)) if @current_user.has_role?(:secretary) %>
<%= content_tag(:p, link_to('Become a member!', new_member_path)) unless @current_user %>
